---
title: "Ellipse functions"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{ellipse_functions}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

<style type="text/css">
  body{
  font-size: 12pt;
}
</style>

```{r, include = FALSE}
knitr::opts_chunk$set(fig.width=7, fig.height=5,
  collapse = TRUE,
  comment = "#>"
)

options(rmarkdown.html_vignette.check_title = FALSE)
```

```{r setup}
library(MVQuickGraphs)
```

The following functions take the mean and covariance matrix associated with a multivariate normal distribution and use eigendecomposition to plot an appropriate ellipse at the (1-`alpha`)100% level. They are particularly appropriate for experimentation by those learning about multidimensional normal distributions.

## Bivariate normal contour ellipses with _bvNormalContour()_

_bvNormalContour()_ plots a contour ellipse of constant density for a bivariate normal distribution. To do this, arguments must be passed to two parameters: `mu` and either `Sigma` *or* `eig`. 

`mu` is the mean of the bivariate normal distribution as represented by a vector. `Sigma` is the associated covariance matrix. If `Sigma` is given, then the function conducts the eigendecomposition itself. Alternatively, the user can provide `eig`, the eigenvalues and eigenvectors of the associated covariance matrix. `eig` must be in the same form as the output from _eigen()_. This means that the argument passed should be a list with an entry containing values and another entry containing vectors. Further, the eigenvalues should be ordered from greatest to least.

Both methods are illustrated below with a simple example. They result in the same ellipse.

```{r}
#specify bivariate distribution
mu <- c(-1,8)
Sigma <- matrix(c(3,2,2,4), ncol = 2)


#providing Sigma
bvNormalContour(mu = mu, Sigma = Sigma)
#providing eig
bvNormalContour(mu = mu, eig = eigen(Sigma))
```

`alpha` can be changed from its default of 0.05. Notice the slight change in the resulting ellipse.

```{r}
bvNormalContour(mu = mu, eig = eigen(Sigma), alpha = 0.01)
```


## Bivariate normal confidence ellipses with _confidenceEllipse()_

For two dimensions under consideration (which are a part of a p-dimensional multivariate normal distribution), _confidenceEllipse()_ plots a two-dimensional confidence ellipse. Arguments must be passed to the following parameters:

- `X.mean`: the mean of the two dimensions under consideration from the distribution, as represented by a column matrix.

- `eigen`: the covariance matrix's eigenvalues and eigenvectors, again in the same form as the output of _eigen()_.

- `n`: the number of observations in the data.

- `p`: the number of dimensions in the p-dimensional multivariate normal distribution.

The example below illustrates basic use of the function for the _ability.cov_ covariance matrix. The necessary values are found first, and then passed to _confidenceEllipse()_.

```{r}
#x.mean
x.bar <- ability.cov$center[5:6]

#eigenvalues and eigenvectors of covariance matrix
eigen_of_cov <- eigen(ability.cov$cov[5:6,5:6])

n <- ability.cov$n.obs #number of observations
p <- length(ability.cov$center) #number of dimensions

confidenceEllipse(X.mean = x.bar,
                  eig = eigen_of_cov,
                  n = n, p = p)
```

## Additional options

Both functions allows for further customization of the generated plot. Examples are provided for _confidenceEllipse()_ but these parameters are available to be edited for _bvNormalContour()_ as well. 

By default, reasonable upper and lower limits for the x-axis and y-axis are chosen by the two functions. With `xl` and `yl`, the user can provide limits via vectors.

```{r}
confidenceEllipse(X.mean = x.bar,
                  eig = eigen_of_cov,
                  n = n, p = p, xl = c(-3.5,3.5), yl = c(-4.5,4.5), alpha = 0.01)
```

If at least one of either `xl` or `yl` is set as NULL, one can adjust the limits computed by the function by providing a value for `lim.adj`. Positive values increase the distance between the upper and lower limits and thus make the ellipse appear smaller. Negative values result in the opposite effect. By default, `lim.adj = 0.02`.

```{r}
#positive value for lim.adj
confidenceEllipse(X.mean = x.bar,
                  eig = eigen_of_cov,
                  n = n, p = p, lim.adj = 0.1, alpha = 0.01)
#negative value for lim.adj
confidenceEllipse(X.mean = x.bar,
                  eig = eigen_of_cov,
                  n = n, p = p, lim.adj = -0.1, alpha = 0.01)
```

If `axes = TRUE` (which is the case by default), the ellipse's major and minor axes are plotted. Thus, to remove them from the ellipse, set `axes = FALSE`.

```{r}
confidenceEllipse(X.mean = x.bar,
                  eig = eigen_of_cov,
                  n = n, p = p, xl = c(-3.5,3.5), yl = c(-4.5,4.5), alpha = 0.01, 
                  axes = FALSE)
```

Further, by default, `center = FALSE`. If `center = TRUE`, the center of the ellipse will be indicated with a point, and dashed lines are drawn from this point to the x- and y-axis.

```{r}
#axes = FALSE and center = TRUE
confidenceEllipse(X.mean = x.bar,
                  eig = eigen_of_cov,
                  n = n, p = p, xl = c(-3.5,3.5), yl = c(-4.5,4.5), alpha = 0.01, 
                  axes = FALSE, center = TRUE)
#axes = TRUE and center = TRUE
confidenceEllipse(X.mean = x.bar,
                  eig = eigen_of_cov,
                  n = n, p = p, xl = c(-3.5,3.5), yl = c(-4.5,4.5), alpha = 0.01, 
                  axes = TRUE, center = TRUE)
```

# References

Johnson, R. A., & Wichern, D. W. (2007). _Applied multivariate statistical analysis (6th ed)_. Pearson Prentice Hall.
